<!DOCTYPE html> <html> <script async src='/javascripts/all-b50ba35a88860abb5643a2e2b58561fc.js'></script> <link href='/stylesheets/all-b50ba35a88860abb5643a2e2b58561fc.css' media='all' rel='stylesheet' type='text/css'> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"> <title>Python, Write My Paper &#8211; cbh</title> <meta name="description" content=""> <meta name="keywords" content="coding, python, fstring, laziness"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:image" content="https://cbeauhilton.github.io//images/unsplash-grey-flowerbuds.jpg"> <meta name="twitter:title" content="Python, Write My Paper"> <meta name="twitter:description" content=""> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="Python, Write My Paper"> <meta property="og:description" content=""> <meta property="og:url" content="https://cbeauhilton.github.io/python-write-my-paper/"> <meta property="og:site_name" content="cbh"> <meta property="og:image" content="https://cbeauhilton.github.io/images/arsenic_logo_300.svg"> <link rel="canonical" href="https://cbeauhilton.github.io/python-write-my-paper/"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Feed --> <link type="application/atom+xml" rel="alternate" href="https://cbeauhilton.github.io/feed.xml" title="cbh" /> <!-- Favicons --> <link rel="shortcut icon" type="image/png" href="https://cbeauhilton.github.io/favicon.png" /> <link rel="shortcut icon" href="https://cbeauhilton.github.io/favicon.ico" /> <!-- CSS --> <link rel="stylesheet" type="text/css" href="https://cbeauhilton.github.io/assets/css/main.css"> <!-- Left Block Image for Posts --> <style type="text/css"> #posts.inner-post-page .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(https://cbeauhilton.github.io//images/unsplash-grey-flowerbuds.jpg) no-repeat;background-size: cover;} </style> <!-- Left Block Images for Home and Pages --> <style type="text/css"> #posts .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(https://cbeauhilton.github.io/images/unsplash-image-10.jpg) no-repeat;background-size: cover, cover;} .block-left {background: linear-gradient(rgba(44,45,51,0.9), rgba(44,45,51,0.9)), url(https://cbeauhilton.github.io/images/home.png) no-repeat;background-size: cover;} </style> </head> <body id="posts" class="inner-post-page"> <div class="block-left"> <div class="content"> <a href="https://cbeauhilton.github.io" class="logo"><img src="https://cbeauhilton.github.io/images/arsenic_logo_300.svg"></a> <div class="post-title-section"> <div class="section-line">Posts <em>/</em></div> <h1 class="section-title">Python, Write My Paper </h1> <ul class="tags"> <li><a href="https://cbeauhilton.github.io/tags#coding">coding</a></li> <li><a href="https://cbeauhilton.github.io/tags#python">python</a></li> <li><a href="https://cbeauhilton.github.io/tags#fstring">fstring</a></li> <li><a href="https://cbeauhilton.github.io/tags#laziness">laziness</a></li> </ul> <div class="section-line reverse"><a href="https://cbeauhilton.github.io/posts">Back to posts</a> <em>/</em></div> </div> </div> </div> <div class="block-right"> <div class="share-buttons"> <a href="https://twitter.com/intent/tweet?text=https://cbeauhilton.github.io/python-write-my-paper/" class="btn btn_twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=https://cbeauhilton.github.io/python-write-my-paper/" class="btn btn_facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://plus.google.com/share?url=https://cbeauhilton.github.io/python-write-my-paper/" class="btn btn_google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a> </div> <a href="../posts.html" title="posts" class="posts-menu-icon"></a> <a title="projects" class="projects-menu-icon"> <span></span> </a> <div class="inner-post content"> <div class="date-highlight">10 Jun 2019</div> <p><img src="https://cbeauhilton.github.io/images/pixabay-lazy-1.png" alt="laziness is prioritization" class="img-responsive" /></p> <p>Computers are good at doing tedious things.<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup></p> <p>Many of the early advances in computing were accomplished to help people do tedious things they didn’t want to do, like the million tiny equations that make up a calculus problem.<sup id="fnref:2"><a href="#fn:2" class="footnote">2</a></sup> It has also been said, and repeated, and I agree, that one of the three virtues of a good programmer is laziness.<sup id="fnref:3"><a href="#fn:3" class="footnote">3</a></sup></p> <p>One of the most tedious parts of my job is writing paragraphs containing the results of lots of math relating to some biomedical research project. To make this way easier, I use a core Python utility called the <code class="highlighter-rouge">f-string</code>, in addition to some other tools I may write about at a later date.<sup id="fnref:4"><a href="#fn:4" class="footnote">4</a></sup></p> <h2 id="the-problem">The problem</h2> <p>First, here’s an example of the kinds of sentences that are tedious to type out, error prone, and have to be fixed every time something changes on the back end (–&gt; more tedium, more room for errors).</p> <p>“In the study period there were 1,485,880 hospitalizations for 708,089 unique patients, 439,696 (62%) of whom had only one hospitalization recorded. The median number of hospitalizations per patient was 1 (range 1-176, [1.0 , 2.0]).”</p> <p>The first paragraph of a results section of a typical medical paper is chock-full of this stuff. If we find an error in how we calculated any of this, or find that there was a mistake in the database that needs fixing (and this happens woefully often), all of the numbers need replaced. It’s a pain. How might we automate the writing of this paragraph?<sup id="fnref:5"><a href="#fn:5" class="footnote">5</a></sup></p> <h2 id="the-solution">The solution</h2> <p>First, we’re going to do the math (which we were doing anyway), and assign each math-y bit a unique name. Then we’re going to plug in the results of these calculations to our sentences. If you’re not familiar with Python or Pandas, don’t worry - just walk through the names and glance at the stuff after the equals sign, but don’t get hung up on it. The basic syntax is:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">some_descriptive_name</span> <span class="o">=</span> <span class="n">some_dataset</span><span class="p">[</span><span class="s">"some_column_in_that_dataset"</span><span class="p">].</span><span class="n">some_mathy_bit</span><span class="p">()</span>
</code></pre></div></div> <p>After we generate the numbers we want, we write the sentence, insert the code, and then use some tricks to get the numbers in the format we want.</p> <p>In most programming languages, “string” means “text, not code or numbers.” So an <code class="highlighter-rouge">f-string</code> is a <code class="highlighter-rouge">formatted-string</code>, and allows us to insert code into blocks of normal words using an easy, intuitive syntax.</p> <p>Here’s an example:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">name_of_word_block</span> <span class="o">=</span> <span class="s">f"""Some words with some </span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s"> we want Python to evaluate,
maybe with some extra formatting thrown in for fun,
such as commas to make long numbers more readable (</span><span class="si">{</span><span class="n">long_number</span><span class="p">:,</span><span class="si">}</span><span class="s">),
or a number of decimal places to round to
(</span><span class="si">{</span><span class="n">number_with_stuff_after_the_decimal_but_we_only_want_two_places</span><span class="p">:.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s">,
or a conversion from a decimal to a percentage and get rid of everything after the '.'
</span><span class="si">{</span><span class="n">some_number_divided_by</span><span class="o">/</span><span class="n">some_other_number</span><span class="o">*</span><span class="mi">100</span><span class="p">:.</span><span class="mi">0</span><span class="n">f</span><span class="si">}</span><span class="s">%)."""</span>
</code></pre></div></div> <p>First, declare the name of the block of words. Then write an <code class="highlighter-rouge">f</code>, which will tell Python we want it to insert the results of some code into the following string, which we start and end with single or triple quotes (triple quotes let you break strings into multiple lines). Add in the code within curly brackets, <code class="highlighter-rouge">{code}</code>, add some optional formatting after a colon, <code class="highlighter-rouge">{code:formatting_options}</code>, and prosper.</p> <p>As you can see from the last clause, you can do additional math or any operation you want within the <code class="highlighter-rouge">{code}</code> block. I typically like to do the math outside of the strings to keep them cleaner looking, but for simple stuff it can be nice to just throw the math in the f-string itself.</p> <p>Here’s the actual code I used to make those first two sentences from earlier. First the example again, then the math, then the f-strings.<sup id="fnref:7"><a href="#fn:7" class="footnote">6</a></sup></p> <p>“In the study period there were 1,485,880 hospitalizations for 708,089 unique patients, 439,696 (62%) of whom had only one hospitalization recorded. The median number of hospitalizations per patient was 1 (range 1-176, [1.0 , 2.0]).”</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">n_encs</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">"encounterid"</span><span class="p">].</span><span class="n">nunique</span><span class="p">()</span>
<span class="n">n_pts</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">"patientid"</span><span class="p">].</span><span class="n">nunique</span><span class="p">()</span>

<span class="n">pts_one_encounter</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s">"encounternum"</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">].</span><span class="n">nunique</span><span class="p">()</span>
<span class="n">min_enc_per_pt</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">"encounternum"</span><span class="p">].</span><span class="nb">min</span><span class="p">()</span>
<span class="n">q1_enc_per_pt</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">"encounternum"</span><span class="p">].</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">median_enc_per_pt</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">"encounternum"</span><span class="p">].</span><span class="n">median</span><span class="p">()</span>
<span class="n">q3_enc_per_pt</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">"encounternum"</span><span class="p">].</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.75</span><span class="p">)</span>
<span class="n">max_enc_per_pt</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">"encounternum"</span><span class="p">].</span><span class="nb">max</span><span class="p">()</span>

<span class="n">sentence01</span> <span class="o">=</span> <span class="s">f"In the study period there were </span><span class="si">{</span><span class="n">n_encs</span><span class="p">:,</span><span class="si">}</span><span class="s"> hospitalizations for </span><span class="si">{</span><span class="n">n_pts</span><span class="p">:,</span><span class="si">}</span><span class="s"> unique patients, </span><span class="si">{</span><span class="n">pts_one_encounter</span><span class="p">:,</span><span class="si">}</span><span class="s"> (</span><span class="si">{</span><span class="n">pts_one_encounter</span><span class="o">/</span><span class="n">n_pts</span><span class="o">*</span><span class="mi">100</span><span class="p">:.</span><span class="mi">0</span><span class="n">f</span><span class="si">}</span><span class="s">%) of whom had only one hospitalization recorded. "</span>
<span class="n">sentence02</span> <span class="o">=</span> <span class="s">f"The median number of hospitalizations per patient was </span><span class="si">{</span><span class="n">median_enc_per_pt</span><span class="p">:.</span><span class="mi">0</span><span class="n">f</span><span class="si">}</span><span class="s"> (range </span><span class="si">{</span><span class="n">min_enc_per_pt</span><span class="p">:.</span><span class="mi">0</span><span class="n">f</span><span class="si">}</span><span class="s">-</span><span class="si">{</span><span class="n">max_enc_per_pt</span><span class="p">:.</span><span class="mi">0</span><span class="n">f</span><span class="si">}</span><span class="s">, [</span><span class="si">{</span><span class="n">q1_enc_per_pt</span><span class="si">}</span><span class="s"> , </span><span class="si">{</span><span class="n">q3_enc_per_pt</span><span class="si">}</span><span class="s">]). "</span>
</code></pre></div></div> <p>If you want to get real <del>lazy</del> <del>fancy</del> lazy, you can combine these sentences into a paragraph, save that paragraph to a text file, and then automatically include this text file in your final document.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">paragraph01</span> <span class="o">=</span> <span class="n">sentence01</span> <span class="o">+</span> <span class="n">sentence02</span>
<span class="n">results_text_file</span> <span class="o">=</span> <span class="s">"results_paragraphs.txt"</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">results_text_file</span><span class="p">,</span> <span class="s">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">text_file</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">paragraph01</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">text_file</span><span class="p">)</span>
</code></pre></div></div> <p>To automatically include the text file in your document, you’ll have to figure out some tool appropriate to your writing environment. I think there’s a way to source text files in Microsoft Word, though I’m less familiar with Word than other document preparation tools such as LaTeX. If you know how to do it in Word, let me know (or I’ll look into it and update this post).</p> <p>Here’s how to do it in LaTeX. Just put <code class="highlighter-rouge"><span class="k">\input</span></code> and the path to your text file at the appropriate place in your document:<sup id="fnref:6"><a href="#fn:6" class="footnote">7</a></sup></p> <div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">\input</span><span class="p">{</span>"results<span class="p">_</span>paragraphs<span class="p">_</span>latex.txt"<span class="p">}</span>
</code></pre></div></div> <p>With this workflow, I can run the entire analysis, have all the mathy bits translated into paragraphs that include the right numbers, and have those paragraphs inserted into my text in the right spots.</p> <p>I should note that there are other ways to do this. There are ways of weaving actual Python and R code into LaTeX documents, and RMarkdown is a cool way of using the simple syntax of Markdown with input from R. I like the modular approach outlined here, as it lets me just tag on a bit to the end of the Python code I was writing anyway, and integrate it into the LaTeX I was writing anyway. I plan to use this approach for the foreseeable future, but if you have strong arguments for why I should switch to another method, I would love to hear it, especially if it might better suit my laziness.</p> <p>Addendum: As I was writing this, I found a similar treatment of the same subject. It’s great, with examples in R and Python. <a href="https://jabranham.com/blog/2018/05/reporting-statistics-in-latex/">Check it out</a>.</p> <div class="footnotes"> <ol> <li id="fn:1"> <p><em>Automate the Boring Stuff</em> by Al Sweigart is a great introduction to programming in general, and is available for free as a <a href="https://automatetheboringstuff.com/">hypertext book</a>. It teaches exactly what its name denotes, in an interactive and easy-to-understand combination of code and explanation. <a href="#fnref:1" class="reversefootnote">&#8617;</a></p> </li> <li id="fn:2"> <p>I’m revisiting [Walter Isaacson’s <em>The Innovators”](https://en.wikipedia.org/wiki/The_Innovators</em>(book)), which I first listened to before I got deeply into programming, and on this go-through I am vibing much harder with the repeated (and repeated) (and again repeated) impetus for building the first and subsequent computing machines: tedious things are tedious. <a href="#fnref:2" class="reversefootnote">&#8617;</a></p> </li> <li id="fn:3"> <p>The other two are impatience and hubris. Here is one of the <a href="http://threevirtues.com/">most lovely websites on the internet</a> <a href="#fnref:3" class="reversefootnote">&#8617;</a></p> </li> <li id="fn:4"> <p>For example, TableOne, which makes the (<em>incredibly</em> tedious) task of making that classic first table in any biomedical research paper <em>so much easier</em>. Here’s a link to <a href="https://github.com/tompollard/tableone">TableOne’s project page</a>, which also includes links out to examples and their academic paper on the software. <a href="#fnref:4" class="reversefootnote">&#8617;</a></p> </li> <li id="fn:5"> <p>Assign it to a resident, of course. <a href="#fnref:5" class="reversefootnote">&#8617;</a></p> </li> <li id="fn:7"> <p>You may have noticed there are two datasets I’m pulling from for this, “data,” which includes everything on the basis of <em>hospitalizations</em>, and “df,” short for “dataframe,” which is a subset of “data” that only includes each <em>patient</em> once (rather than a new entry for every hospitalization), along with a few other alterations that allow me to do patient-wise calculations. <a href="#fnref:7" class="reversefootnote">&#8617;</a></p> </li> <li id="fn:6"> <p>You may have noticed that the name of this file is “results_paragraphs_latex.txt” rather than “results_paragraphs.txt,” and that’s because LaTeX needs a little special treatment if you’re going to use the percentage symbol. LaTeX uses the percentage symbol as a comment sign, meaning that anything after the symbol is ignored and left out of the document. You have to “escape” the percentage symbol with a slash, like this: <code class="highlighter-rouge">\%</code>. I have this simple bit of code that converts the normal text file into a LaTeX-friendly version:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># make a LaTeX-friendly version (escape the % symbols with \)
# Read in the file
</span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">results_text_file</span><span class="p">,</span> <span class="s">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
    <span class="n">filedata</span> <span class="o">=</span> <span class="nb">file</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>
<span class="c1"># Replace the target string
</span><span class="n">filedata</span> <span class="o">=</span> <span class="n">filedata</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">"%"</span><span class="p">,</span> <span class="s">"\%"</span><span class="p">)</span>
<span class="c1"># Write the file
</span><span class="n">text_file_latex</span> <span class="o">=</span> <span class="s">"results_paragraphs_latex.txt"</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">text_file_latex</span><span class="p">,</span> <span class="s">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
    <span class="nb">file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">filedata</span><span class="p">)</span>
</code></pre></div> </div> <p><a href="#fnref:6" class="reversefootnote">&#8617;</a></p> </li> </ol> </div> <br> <a href="https://twitter.com/intent/tweet?text=https://cbeauhilton.github.io/python-write-my-paper/" class="btn btn_twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=https://cbeauhilton.github.io/python-write-my-paper/" class="btn btn_facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://plus.google.com/share?url=https://cbeauhilton.github.io/python-write-my-paper/" class="btn btn_google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a> <nav class="pagination"> <a href="https://cbeauhilton.github.io/Artificial-Intelligence-Definitions-and-Indefinitions/" class="pagination_pager" title="On the buzziest of buzzwords: what is AI, anyway? ">previous</a> <a href="https://cbeauhilton.github.io/chrome-extensions/" class="pagination_pager" title="Chrome Extensions I’ve Known and Loved ">next</a> </nav> </div> </div> <!-- JS --> <script src="https://cbeauhilton.github.io/assets/js/main.min.js"></script> <!-- Asynchronous Google Analytics snippet --> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-124056131-1', 'auto'); ga('require', 'linkid', 'linkid.js'); ga('send', 'pageview'); </script> <div class="overlay"> <ul class="projects-menu"> <li style="background:url(https://semiengineering.com/wp-content/uploads/2018/03/data-and-connections.jpg) center center no-repeat;"> <a href="https://github.com/cbeauhilton/ML-Setup-and-Practice-for-CCLCM" target="_blank" rel="nofollow external"> <span> Machine Learning Interest Group, CCLCM </span> </a> </li> <li style="background:url(https://github.com/cbeauhilton/AI-for-MDs/raw/master/rawpixel-618738-unsplash.jpg) center center no-repeat;"> <a href="https://github.com/cbeauhilton/AI-for-MDs" target="_blank" rel="nofollow external"> <span> AI for MDs </span> </a> </li> <li style="background:url(https://github.com/cbeauhilton/Marrowless-Diagnosis/raw/master/dawid-zawila-192545-unsplash.jpg) center center no-repeat;"> <a href="https://github.com/cbeauhilton/Marrowless-Diagnosis" target="_blank" rel="nofollow external"> <span> Marrowless Diagnosis </span> </a> </li> <li style="background:url(https://github.com/cbeauhilton/Deep-Learning-for-Bone-Marrow/raw/master/mds.PNG) center center no-repeat;"> <a href="https://github.com/cbeauhilton/Deep-Learning-for-Bone-Marrow" target="_blank" rel="nofollow external"> <span> Deep Learning for Bone Marrow </span> </a> </li> </ul> </div> <script> //open external links in a new window function external_new_window() { for(var c = document.getElementsByTagName("a"), a = 0;a < c.length;a++) { var b = c[a]; b.getAttribute("href") && b.hostname !== location.hostname && (b.target = "_blank") } } //open PDF links in a new window function pdf_new_window () { if (!document.getElementsByTagName) return false; var links = document.getElementsByTagName("a"); for (var eleLink=0; eleLink < links.length; eleLink ++) { if ((links[eleLink].href.indexOf('.pdf') !== -1)||(links[eleLink].href.indexOf('.doc') !== -1)||(links[eleLink].href.indexOf('.docx') !== -1)) { links[eleLink].onclick = function() { window.open(this.href); return false; } } } } pdf_new_window() external_new_window(); </script> </body> </html>
